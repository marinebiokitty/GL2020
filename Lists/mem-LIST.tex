%%%%%
%%
%% This file sets up the Mem, MemFold, and MemEnvelope datatypes, and
%% creates possible macros for each.
%%
%% The Mem datatype isn't really used directly; it's there so the
%% other datatypes can inherit and share its code.
%%
%%%%%

\DECLARESUBTYPE{Mem}{Element}
\PRESETS{Mem}{
  %% \MYname is the trigger
  \F\MYtext	%%  text
  }


%%%%%
%% MemFold and MemEnvelope are both subtypes of Mem.  MemFold is for
%% fold-n-staple style mempackets, MemEnvelope is for stuff-n-seal
%% style mempackets.  If you want a mempacket to contain interesting
%% contents, like sheets, abilities, and other mempackets, use a
%% MemEnvelope.
\DECLARESUBTYPE{MemFold}{Mem}
\DECLARESUBTYPE{MemEnvelope}{Mem}


%%%%%
%% MemCover and MemPage are for the cover and pages of mempacket
%% booklets, which resemble research notebooks.  These are good
%% substitutes for large piles of MemFolds, and can be useful for
%% things like amnesiac characters.
%%
%% Like MemFolds, MemPages shouldn't directly own any other elements
%% as contents.  Use MemEnvelope instead.
%%
%% MemPages are usually assigned to a MemCover (via \MYmems), with the
%% MemCover representing the entire booklet and assigned to a
%% character.
%%
%% A MemCover is not a mempacket in and of itself; its name is not its
%% trigger and its text is not a memory.
\DECLARESUBTYPE{MemCover}{Mem}
\PRESETS{MemCover}{
  \sd\MYtext	{Each page is a memory/event packet with a separate
		trigger.}
  }

\DECLARESUBTYPE{MemPage}{Mem}


%%%%%
%% \memfold{<trigger>}{<text>}
%% \memenvelope{<trigger>}{<text>}
%% \memcover{<name>}{<pages>}
%% \mempage{<trigger>}{<text>}
%% \startmembook{<name>} <pages> \endmembook
%%
%% These are wrappers around \INSTANCE, useful as 1-shots.
%% \startmembook...\endmembook is a simple wrapper around \memcover
%% that may have better syntax for use within character sheets (inside
%% a \starttag{mems}...\endtag block).
\newinstance{MemFold}{\memfold[2]}{
  \s\MYname{#1}\s\MYtext{#2}}
\newinstance{MemEnvelope}{\memenvelope[2]}{
  \s\MYname{#1}\s\MYtext{#2}}
\newinstance{MemCover}{\memcover[2]}{
  \s\MYname{#1}\s\MYmems{#2}}
\newinstance{MemPage}{\mempage[2]}{
  \s\MYname{#1}\s\MYtext{#2}}

\long\def\startmembook#1#2\endmembook{\memcover{#1}{#2}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NEW{MemFold}{\mTest}{
  \s\MYname	{Test Trigger}
  \s\MYtext	{This is a Test of a fold-n-staple memory packet}
  }
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\NEW{MemEnvelope}{\mPacketA}{
  \s\MYname	{Packet A: Do not open unless directed to do so.}
  \s\MYtext	{You are suddenly flooded with memories and sensations. \textbf{Fall unconscious for 5 minutes.} You can use that time to read the rest of the stuff inside this packet.

\emph{In your unconscious state, the following memories and knowledge flood into you.}

It’s dim, and warm. You’re underground. No, you’re in a huge stone room. Every door is blocked by heavy stones. There are many people here. You can’t see them distinctly. But you hear the rustle of cloth. And a sense of anticipation. Your own heart beats fast with excitement. The candle-light flickers. There must be hundreds of ritual candles everywhere. They contribute to the heat and the stuffiness. Excited whispers flow across the room and then fall silent as the head Cleric of the Aethers steps into the center of the room, into the center of the ritual circle.

This is it. You’re going to the Realm of the Gods. You are going to talk to \cFarmGod{} face to face. See the great tree where the hummingbird avatars rest between missions. Walk where no human has walked since time immemorial when the Deities were forced to sever the connection between the material plane and the Divine Realm. The Aethers have been preparing for this moment for years. A massive, exhausting (and technically illegal according to the mainstream church) ritual to forge a bridge to the Divine realm, paired with the deeply personal process of becoming corporeal on the Divine plane, and incorporeal on the mundane one. 

The ritual begins. The magical energy builds as the group chants and sways. Sweeping your spirit up in a vortex of jubilation. You lose track of time. How long has it been? Minutes? Hours? Days? You watch as the leader of the Aethers invokes the personal change to become incorporeal on the material plane. It’s happening. It’s really happening.

And then there is a massive crashing sound! Utterly discordant with the power of the Aethers. A crack appears in one of the stones used to seal the doorways. Another massive crash. More cracks, this time in more of the seals. You’re surrounded. Trapped.  The crowd of Aethers is thrown into chaos. The magical energy spins out of control. Any hope of reaching the Divine Realm shredding before your eyes. The stones give way. People you don’t recognize enter the chamber from every direction. They point their wands and staves at the wall, the ceiling, and the floor. Thunderous blasts shatter the structure. Chunks of stone start to rain from the ceiling. There is nowhere to run. Nowhere to escape to. Your friends, your family, are being hurt, being killed\ldots

As you stare in horror,  \cDisneyMentor{} grabs your shoulder and pulls you away, through a secret passage. \cDisneyMentor{\They} close\cDisneyMentor{\plural} the doorway behind you, sending a quick muttered prayer to \cFarmGod{} that no one saw in the chaos. Down toward the crypt the two of you hurry. \cDisneyMentor{\They} pulls you toward a glass coffin. ``Here’’ \cDisneyMentor{\they} say, ``You must come here. I’m going to put you into a magical sleep. Hopefully they will think you don’t know anything and leave you be.’’ ``But what about you?’’ you whisper, tears filling your eyes. ``Don’t worry about me,’’ \cDisneyMentor{} replies soothingly. As you lay down in the coffin, \cDisneyMentor{} kisses your forehead. A feeling of warmth and peace flows over you, washing away the memories of this dreadful night, and the knowledge of how to create a celestial body. ``Sleep well child’’ \cDisneyMentor{} whispers. ``May you wake in a more tolerant time.’’

\emph{When you wake from being unconscious you will remember all of this, and have access to the ``\aCelestialBody{}'' ability included in this packet.}
}
	\s\MYabils {\aCelestialBody{}}
  }
	
	
%%%%%%%%%%%%% Mem Books %%%%%%%%%%%%%%%

\NEW{MemCover}{\mReversingMindWipe}{
  \s\MYname	{Reversing A Mind Wipe}
  \s\MYmems	{\mWipeOne{}}
  }

\NEW{MemPage}{\mWipeOne{}}{
  \s\MYname	{}
  \s\MYtext	{}
  }